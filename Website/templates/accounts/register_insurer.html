<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BimaDrive | Insurer Registration</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
            --app-gradient: linear-gradient(135deg, #4e37b5 0%, #46bbf4 100%);
            --primary-color: #4e37b5;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body {
            height: 100vh; display: flex; align-items: center; justify-content: center;
            background: var(--app-gradient);
        }

        .container-wrapper {
            width: 950px; height: 600px; background: #fff; border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25); display: flex; overflow: hidden;
            flex-direction: row-reverse;
        }

        .visual-side {
            width: 40%; background: var(--app-gradient);
            position: relative; display: flex; flex-direction: column;
            justify-content: center; padding: 40px; color: white;
            clip-path: polygon(15% 0, 100% 0, 100% 100%, 0% 100%);
        }
        .visual-side h2 { font-size: 32px; margin-bottom: 20px; font-weight: 700; text-align: right; }
        .visual-side p { font-size: 14px; opacity: 0.9; line-height: 1.6; text-align: right; }
        .visual-icon { font-size: 80px; margin-bottom: 20px; opacity: 0.2; position: absolute; bottom: 20px; right: 20px; }

        .form-side {
            width: 60%; padding: 50px; display: flex; flex-direction: column;
            overflow-y: auto;
        }

        .form-header { margin-bottom: 30px; text-align: center; }
        .form-header h3 { color: var(--primary-color); font-weight: 700; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 13px; color: #777; margin-bottom: 5px; font-weight: 500; }
        .form-group input {
            width: 100%; padding: 12px; border: 1px solid #e1e1e1; border-radius: 8px;
            font-size: 14px; transition: 0.3s;
        }
        .form-group input:focus { border-color: #46bbf4; outline: none; background: #f9fcff; }

        .btn-register {
            width: 100%; padding: 14px; background: var(--app-gradient);
            border: none; border-radius: 10px; color: white; font-weight: 600;
            margin-top: 10px; cursor: pointer; transition: 0.3s;
        }
        .btn-register:hover { box-shadow: 0 5px 15px rgba(78, 55, 181, 0.3); transform: translateY(-2px); }
        .btn-register:disabled { opacity: 0.7; cursor: not-allowed; }

        .login-link { text-align: center; margin-top: 20px; font-size: 13px; color: #888; }
        .login-link a { color: var(--primary-color); font-weight: 600; text-decoration: none; }

        .animate-fade { animation: fadeIn 0.8s ease forwards; opacity: 0; }
        @keyframes fadeIn { to { opacity: 1; } }

        #error-msg { color: red; font-size: 12px; margin-bottom: 10px; display: none; text-align: center; }

    </style>
</head>
<body>

<div class="container-wrapper">
    <div class="visual-side">
        <i class="bi bi-briefcase-fill visual-icon"></i>
        <h2 class="animate-fade" style="animation-delay: 0.1s;">Partner With Us</h2>
        <p class="animate-fade" style="animation-delay: 0.2s;">Register as an Insurer to reach a broader audience and streamline your claims process.</p>
    </div>

    <div class="form-side">
        <div class="form-header animate-fade" style="animation-delay: 0.3s;">
            <h3>Insurer Registration</h3>
        </div>

        <div id="error-msg"></div>

        <form id="regForm" class="animate-fade" style="animation-delay: 0.4s;">
            <div class="form-group">
                <label>Staff ID</label>
                <input type="text" id="staffId" required placeholder="e.g. INS-9921">
            </div>

            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="fullname" required>
            </div>

            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="email" required>
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password" required>
            </div>

            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" id="confirm_password" required>
            </div>

            <button type="submit" class="btn-register">Register Partner</button>
            <div class="login-link">
                Already have an account? <a href="login.html">Login here</a>
            </div>
        </form>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    // Configuration from your JSON file
    const firebaseConfig = {
        apiKey: "AIzaSyCfZ4L9Qf--qXVt6fSTovL6NufC-UEUHv8",
        authDomain: "bimadrive-46fd0.firebaseapp.com",
        databaseURL: "https://bimadrive-46fd0-default-rtdb.firebaseio.com",
        projectId: "bimadrive-46fd0",
        storageBucket: "bimadrive-46fd0.firebasestorage.app",
        messagingSenderId: "672547346096",
        appId: "1:672547346096:android:116a85b7da6254b5b88d75"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const regForm = document.getElementById('regForm');
    const errorMsg = document.getElementById('error-msg');
    const btn = document.querySelector('.btn-register');

    regForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const staffId = document.getElementById('staffId').value;
        const name = document.getElementById('fullname').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirm = document.getElementById('confirm_password').value;

        errorMsg.style.display = 'none';

        if (password !== confirm) {
            errorMsg.textContent = "Passwords do not match.";
            errorMsg.style.display = 'block';
            return;
        }

        btn.disabled = true;
        btn.textContent = "Registering...";

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            // Updated to write to 'Staff' node to match your Security Rules
            await set(ref(db, 'Staff/' + user.uid), {
                name: name,
                staffId: staffId,
                email: email,
                role: 'insurer',
                createdAt: new Date().toISOString()
            });

            alert("Partner Registration successful! Please sign in.");
            window.location.href = 'login.html';

        } catch (error) {
            console.error(error);
            errorMsg.textContent = error.message;
            errorMsg.style.display = 'block';
        } finally {
            btn.disabled = false;
            btn.textContent = "Register Partner";
        }
    });
</script>

</body>
</html>