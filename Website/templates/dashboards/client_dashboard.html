{% load static %}



<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BimaDrive | Client Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #4e37b5 0%, #46bbf4 100%);
            --sidebar-bg: #1a1a2e;
            --bg-body: #f3f5f9;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.08);
            --sidebar-width: 280px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg-body); display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width); background: var(--sidebar-bg); padding: 40px 30px;
            position: fixed; height: 100vh; display: flex; flex-direction: column; color: white;
            box-shadow: 5px 0 20px rgba(0,0,0,0.05); z-index: 100;
        }
        .logo { font-size: 26px; font-weight: 700; color: white; margin-bottom: 60px; display: flex; align-items: center; gap: 12px; text-decoration: none; }
        .logo i { color: #46bbf4; font-size: 30px; }

        .menu-item {
            display: flex; align-items: center; gap: 15px; padding: 16px 20px;
            color: rgba(255,255,255,0.6); text-decoration: none; border-radius: 16px;
            margin-bottom: 12px; transition: 0.3s; font-weight: 500; font-size: 15px;
        }
        .menu-item:hover, .menu-item.active {
            background: rgba(255,255,255,0.1); color: white;
            border-left: 4px solid #46bbf4;
        }
        .menu-item i { font-size: 20px; width: 25px; }

        /* Main Content */
        .main-content { margin-left: var(--sidebar-width); flex: 1; position: relative; }

        /* Hero Banner */
        .dashboard-hero {
            background: var(--primary-gradient);
            height: 250px;
            padding: 40px 50px;
            color: white;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            position: relative;
        }
        .hero-title h1 { font-size: 32px; font-weight: 700; margin-bottom: 5px; }
        .hero-title p { opacity: 0.8; font-size: 14px; }

        /* Profile Pill */
        .profile-pill {
            position: absolute; top: 40px; right: 50px;
            background: rgba(255,255,255,0.2); backdrop-filter: blur(10px);
            padding: 8px 20px; border-radius: 30px;
            display: flex; align-items: center; gap: 15px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .user-avatar {
            width: 35px; height: 35px; background: white; color: #4e37b5;
            border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;
        }

        /* Dashboard Grid */
        .dashboard-container {
            padding: 0 50px 50px;
            margin-top: -80px; /* Overlap effect */
            position: relative; z-index: 10;
        }

        .grid-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; }

        .card {
            background: white; border-radius: 24px; padding: 30px;
            box-shadow: var(--card-shadow); transition: 0.4s;
            display: flex; flex-direction: column; position: relative; overflow: hidden;
            border: 1px solid rgba(0,0,0,0.02);
        }
        .card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.12); }

        .icon-box {
            width: 70px; height: 70px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; margin-bottom: 20px;
        }
        .icon-primary { background: #eff4ff; color: #4e37b5; }
        .icon-accent { background: #e0f7fa; color: #00bcd4; }
        .icon-warn { background: #fff8e1; color: #ffc107; }
        .icon-success { background: #e6fdf3; color: #05cd99; }

        .card h3 { font-size: 20px; color: #1a1a2e; margin-bottom: 10px; font-weight: 700; }
        .card p { color: #8898aa; font-size: 13px; line-height: 1.6; margin-bottom: 25px; flex-grow: 1; }

        .btn-card {
            padding: 12px; border-radius: 12px; text-align: center; text-decoration: none;
            font-weight: 600; font-size: 14px; transition: 0.3s; cursor: pointer;
            display: block;
        }
        .btn-fill { background: #1a1a2e; color: white; }
        .btn-fill:hover { background: #4e37b5; box-shadow: 0 5px 15px rgba(78, 55, 181, 0.3); }

        .btn-grad { background: var(--primary-gradient); color: white; border: none; }
        .btn-grad:hover { box-shadow: 0 8px 20px rgba(70, 187, 244, 0.4); }

        /* Highlight Card (Towing) */
        .card-highlight { background: #1a1a2e; color: white; }
        .card-highlight h3 { color: white; }
        .card-highlight p { color: rgba(255,255,255,0.7); }
        .card-highlight .icon-box { background: rgba(255,255,255,0.1); color: #46bbf4; }
        .card-highlight .btn-card { background: white; color: #1a1a2e; }

    </style>
</head>
<body>

    <div class="sidebar">
        <a href="#" class="logo"><i class="bi bi-shield-check-fill"></i> BimaDrive</a>

        <div style="margin-top: 20px;">
            <a href="{% url 'client_dashboard' %}" class="menu-item active"><i class="bi bi-grid-fill"></i> Dashboard</a>
            <a href="{% url 'profile' %}" class="menu-item"><i class="bi bi-person-circle"></i> My Profile</a>
            <a href="{% url 'add_vehicle' %}" class="menu-item"><i class="bi bi-plus-circle-fill"></i> Add Vehicle</a>
            <a href="{% url 'view_vehicle' %}" class="menu-item"><i class="bi bi-car-front-fill"></i> My Vehicles</a>
            <a href="{% url 'cover' %}" class="menu-item"><i class="bi bi-shield-check"></i> My Cover</a>
            <a href="{% url 'client_claims' %}" class="menu-item"><i class="bi bi-exclamation-triangle-fill"></i> Track Claims</a>
            <a href="{% url 'client_valuation' %}" class="menu-item"><i class="bi bi-camera-fill"></i> Valuation</a>
        </div>

        <a href="#" id="logoutBtn" class="menu-item" style="margin-top: auto; color: #ff6b6b;"><i class="bi bi-box-arrow-left"></i> Logout</a>
    </div>

    <div class="main-content">
        <div class="dashboard-hero">
            <div class="hero-title">
                <h1 id="welcomeText">Hello, Client ðŸ‘‹</h1>
                <p>Welcome to your personal insurance command center.</p>
            </div>

            <div class="profile-pill">
                <span id="profileName">Loading...</span>
                <div class="user-avatar" id="profileInitials">--</div>
            </div>
        </div>

        <div class="dashboard-container">
            <div class="grid-cards">

                <!-- 1. Towing (Highlighted) -->
                <div class="card card-highlight">
                    <div class="icon-box"><i class="bi bi-truck-front-fill"></i></div>
                    <h3>Need a Tow?</h3>
                    <p style="margin-bottom: 25px;">Stuck on the road? Tap below to broadcast your location to our nearest partner.</p>
                    <a href="{% url 'towing' %}" class="btn-card">Request Tow Truck</a>
                </div>

                <!-- 2. Insurance Cover -->
                <div class="card">
                    <div class="icon-box icon-success"><i class="bi bi-shield-check"></i></div>
                    <h3>My Insurance</h3>
                    <p style="color: #8898aa; margin-bottom: 25px;">View your vehicle's valuation value and select your premium plan.</p>
                    <a href="{% url 'cover' %}" class="btn-card btn-fill">View Cover Details</a>
                </div>

                <!-- 3. Add Vehicle -->
                <div class="card">
                    <div class="icon-box icon-primary"><i class="bi bi-car-front"></i></div>
                    <h3>Register Vehicle</h3>
                    <p style="color: #8898aa; margin-bottom: 25px;">Add a new car to your garage to start the valuation process.</p>
                    <a href="{% url 'add_vehicle' %}" class="btn-card btn-fill">Add New Vehicle</a>
                </div>

                <!-- 4. Report Accident -->
                <div class="card">
                    <div class="icon-box icon-warn"><i class="bi bi-cone-striped"></i></div>
                    <h3>Report Incident</h3>
                    <p style="color: #8898aa; margin-bottom: 25px;">Involved in an accident? File a claim report securely.</p>
                    <a href="{% url 'report_accident' %}" class="btn-card btn-grad">File Report</a>
                </div>

                <!-- 5. Valuation -->
                <div class="card">
                    <div class="icon-box icon-accent"><i class="bi bi-camera"></i></div>
                    <h3>Valuation</h3>
                    <p style="color: #8898aa; margin-bottom: 25px;">Upload photos of your vehicle components for insurer assessment.</p>
                    <a href="{% url 'client_valuation' %}" class="btn-card btn-fill" style="background: #f4f7fe; color: #4e37b5;">Start Process</a>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfZ4L9Qf--qXVt6fSTovL6NufC-UEUHv8",
            authDomain: "bimadrive-46fd0.firebaseapp.com",
            databaseURL: "https://bimadrive-46fd0-default-rtdb.firebaseio.com",
            projectId: "bimadrive-46fd0",
            storageBucket: "bimadrive-46fd0.firebasestorage.app",
            messagingSenderId: "672547346096",
            appId: "1:672547346096:android:116a85b7da6254b5b88d75"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const dbRef = ref(db);
                try {
                    let snapshot = await get(child(dbRef, `Client/${user.uid}`));

                    if (!snapshot.exists()) {
                        // Check fallback location if data structure changed
                        const appId = firebaseConfig.projectId;
                        snapshot = await get(child(dbRef, `artifacts/${appId}/users/${user.uid}/profile`));
                    }

                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        const name = data.name || "Client";

                        document.getElementById('welcomeText').innerText = `Hello, ${name.split(' ')[0]} ðŸ‘‹`;
                        document.getElementById('profileName').innerText = name;
                        document.getElementById('profileInitials').innerText = name.charAt(0).toUpperCase();
                    } else {
                        console.log("No client data found.");
                    }
                } catch (error) {
                    console.error("Error fetching user data:", error);
                }
            } else {
                window.location.href = "{% url 'login' %}";
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            signOut(auth).then(() => window.location.href = "{% url 'login' %}");
        });
    </script>

</body>
</html>